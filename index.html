<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#001a33">
    <meta name="description" content="Checklist Volpini - App de Vistoria">
    <title>Checklist Volpini</title>
    
    <!-- Biblioteca PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --primary: #d4af37; /* Dourado */
            --dark: #001a33;    /* Azul Escuro */
            --light: #f4f6f8;
            --text: #333;
            --border: #e0e0e0;
            --success: #27ae60;
            --danger: #e74c3c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--light);
            color: var(--text);
            padding: 15px;
            padding-bottom: 40px;
        }

        .app-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            position: relative;
        }

        /* --- HEADER --- */
        .header {
            background: linear-gradient(135deg, var(--dark) 0%, #002b55 100%);
            color: var(--primary);
            padding: 25px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 4px solid var(--primary);
        }

        .logo-box {
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 10px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .logo-box img { width: 100%; height: 100%; object-fit: contain; }

        .header-info h1 { font-size: 24px; font-weight: 800; text-transform: uppercase; margin-bottom: 5px; color: white; }
        .header-info p { font-size: 13px; opacity: 0.9; color: var(--primary); }
        .header-sub { font-size: 12px; margin-top: 5px; opacity: 0.7; color: white; }

        /* --- TABS --- */
        .tabs {
            display: flex;
            background: #fff;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--dark);
            border-bottom-color: var(--primary);
            background: #fcfcfc;
        }

        /* --- CONTENT --- */
        .tab-content { display: none; padding: 25px; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .section-header {
            background: var(--light);
            padding: 10px 15px;
            border-left: 4px solid var(--primary);
            font-weight: 700;
            color: var(--dark);
            margin: 25px 0 15px 0;
            border-radius: 0 4px 4px 0;
            font-size: 14px;
        }
        .section-header:first-of-type { margin-top: 0; }

        /* --- FORMS --- */
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .full { grid-template-columns: 1fr; }

        label { display: block; font-size: 12px; font-weight: 600; margin-bottom: 5px; color: #555; }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: #fff;
            transition: 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        textarea { min-height: 80px; resize: vertical; }

        /* --- CHECKBOXES --- */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .cb-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .cb-item:hover { background: #fff; border-color: var(--border); }
        .cb-item input { width: 16px; height: 16px; margin: 0; }
        .cb-item label { margin: 0; cursor: pointer; font-weight: 500; }

        /* --- BUTTONS --- */
        .actions-bar {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.1s;
            min-width: 120px;
        }

        .btn:active { transform: scale(0.98); }

        .btn-primary { background: var(--primary); color: var(--dark); }
        .btn-success { background: var(--success); color: white; }
        .btn-secondary { background: var(--dark); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #666; }

        /* --- HISTORY LIST --- */
        .history-item {
            background: white;
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-info h4 { color: var(--dark); font-size: 16px; margin-bottom: 4px; }
        .history-info span { font-size: 12px; color: #777; background: #eee; padding: 2px 6px; border-radius: 4px; }
        
        /* --- ALERTS --- */
        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
            font-size: 14px;
            text-align: center;
        }
        .alert.show { display: block; animation: slideDown 0.3s; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        @keyframes slideDown { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- PDF PRINT HELPERS --- */
        .pdf-watermark { display: none; text-align: center; font-size: 10px; color: #999; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }

        /* Esconde elementos ao gerar PDF */
        .hide-on-pdf { } 

        @media (max-width: 600px) {
            .row { grid-template-columns: 1fr; }
            .header { flex-direction: column; text-align: center; }
            .actions-bar { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div class="app-container" id="appContainer">
        <!-- HEADER -->
        <div class="header">
            <div class="logo-box">
                <img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/bbac6cb8-036e-4ce1-852d-e6c3397ecc20" alt="Volpini Logo">
            </div>
            <div class="header-info">
                <h1>Checklist de Oficina</h1>
                <p>Inspe√ß√£o e Servi√ßos Automotivos</p>
                <div class="header-sub">R. D, 101 - Jardim Vera Cruz, Contagem - MG | (31) 99331-0800</div>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs hide-on-pdf">
            <button class="tab-btn active" onclick="switchTab('novo')">‚ûï Novo</button>
            <button class="tab-btn" onclick="switchTab('historico')">üìã Hist√≥rico</button>
        </div>

        <!-- ABA: NOVO CHECKLIST -->
        <div id="novo" class="tab-content active">
            <div id="msgBox" class="alert"></div>

            <form id="checklistForm">
                <!-- CLIENTE -->
                <div class="section-header">üë§ DADOS DO CLIENTE</div>
                <div class="row">
                    <div>
                        <label>Nome do Cliente *</label>
                        <input type="text" id="nome" required placeholder="Ex: Jo√£o da Silva">
                    </div>
                    <div>
                        <label>Telefone / Celular</label>
                        <input type="tel" id="telefone" placeholder="(31) 99999-9999">
                    </div>
                </div>
                <div class="row full">
                    <div>
                        <label>Endere√ßo</label>
                        <input type="text" id="endereco" placeholder="Rua, Bairro, Cidade">
                    </div>
                </div>

                <!-- VE√çCULO -->
                <div class="section-header">üöó DADOS DO VE√çCULO</div>
                <div class="row">
                    <div>
                        <label>Placa *</label>
                        <input type="text" id="placa" required placeholder="ABC-1234" maxlength="8" style="text-transform: uppercase;">
                    </div>
                    <div>
                        <label>Modelo / Marca</label>
                        <input type="text" id="modelo" placeholder="Ex: Fiat Palio">
                    </div>
                </div>
                <div class="row">
                    <div>
                        <label>KM Entrada</label>
                        <input type="number" id="km" placeholder="000000">
                    </div>
                    <div>
                        <label>Combust√≠vel</label>
                        <select id="combustivel">
                            <option value="Reserva">Reserva</option>
                            <option value="1/4">1/4</option>
                            <option value="Meio">Meio</option>
                            <option value="3/4">3/4</option>
                            <option value="Cheio">Cheio</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                     <div>
                        <label>Data</label>
                        <input type="date" id="data">
                    </div>
                </div>

                <!-- ITENS DE VISTORIA -->
                <div class="section-header">üîß ITENS DE VISTORIA E ACESS√ìRIOS</div>
                
                <label style="margin-bottom: 10px; display:block; color:var(--primary);">Marque o que o ve√≠culo possui:</label>
                
                <div class="checkbox-grid">
                    <div class="cb-item"><input type="checkbox" name="item" value="Estepe" id="i1"><label for="i1">Estepe</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Macaco" id="i2"><label for="i2">Macaco</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Chave Roda" id="i3"><label for="i3">Chave Roda</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Tri√¢ngulo" id="i4"><label for="i4">Tri√¢ngulo</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Extintor" id="i5"><label for="i5">Extintor</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Som/R√°dio" id="i6"><label for="i6">Som/R√°dio</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Tapetes" id="i7"><label for="i7">Tapetes</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Antena" id="i8"><label for="i8">Antena</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Doc. Ve√≠culo" id="i9"><label for="i9">Doc. Ve√≠culo</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Ar Cond." id="i10"><label for="i10">Ar Cond.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Vidro El√©t." id="i11"><label for="i11">Vidro El√©t.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Trava El√©t." id="i12"><label for="i12">Trava El√©t.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Alarme" id="i13"><label for="i13">Alarme</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="G.N.V" id="i14"><label for="i14">G.N.V</label></div>
                </div>

                <!-- SERVI√áOS -->
                <div class="section-header">üìù SERVI√áOS SOLICITADOS / OBS</div>
                <div class="row full">
                    <textarea id="obs" placeholder="Descreva os servi√ßos a serem realizados ou observa√ß√µes sobre avarias..."></textarea>
                </div>
                
                <div class="pdf-watermark">Documento gerado digitalmente via App Checklist Volpini</div>
            </form>

            <div class="actions-bar hide-on-pdf">
                <button class="btn btn-primary" onclick="salvarChecklist()">üíæ Salvar</button>
                <button class="btn btn-success" id="btnPdf" onclick="gerarPDF()">üìÑ Baixar PDF</button>
                <button class="btn btn-outline" onclick="limparTela()">üóëÔ∏è Limpar</button>
            </div>
        </div>

        <!-- ABA: HIST√ìRICO -->
        <div id="historico" class="tab-content">
            <div class="section-header">üóÇÔ∏è CHECKLISTS SALVOS</div>
            <div id="listaHistorico"></div>
            <button class="btn btn-outline" style="width:100%; margin-top:20px;" onclick="limparHistorico()">Limpar Todo Hist√≥rico</button>
        </div>
    </div>

    <script>
        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            document.getElementById('data').valueAsDate = new Date();
            carregarHistorico();
        };

        // --- NAVEGA√á√ÉO ---
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        // --- MENSAGENS ---
        function showMsg(text, type = 'success') {
            const el = document.getElementById('msgBox');
            el.className = `alert alert-${type} show`;
            el.textContent = text;
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // --- SALVAR LOCALMENTE ---
        function salvarChecklist() {
            const placa = document.getElementById('placa').value.toUpperCase();
            const cliente = document.getElementById('nome').value;

            if (!placa || !cliente) {
                showMsg('Preencha Placa e Nome do Cliente!', 'error');
                return false;
            }

            const checklist = {
                id: Date.now(),
                data: new Date().toLocaleString('pt-BR'),
                placa, cliente,
                modelo: document.getElementById('modelo').value,
                telefone: document.getElementById('telefone').value,
                endereco: document.getElementById('endereco').value,
                km: document.getElementById('km').value,
                combustivel: document.getElementById('combustivel').value,
                obs: document.getElementById('obs').value,
                itens: Array.from(document.querySelectorAll('input[name="item"]:checked')).map(cb => cb.value)
            };

            const db = JSON.parse(localStorage.getItem('volpini_db') || '[]');
            db.unshift(checklist);
            localStorage.setItem('volpini_db', JSON.stringify(db));
            
            showMsg('Checklist Salvo com Sucesso!');
            carregarHistorico();
            return true;
        }

        // --- GERAR PDF (CORRIGIDO PARA N√ÉO SAIR EM BRANCO) ---
        function gerarPDF() {
            // 1. Valida√ß√£o b√°sica
            const placa = document.getElementById('placa').value.toUpperCase() || 'SEM-PLACA';
            
            // 2. Prepara UI
            const btn = document.getElementById('btnPdf');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Gerando...';
            btn.disabled = true;

            // 3. Seleciona o container principal que tem o Header e o Form
            const element = document.getElementById('appContainer');
            
            // 4. Configura√ß√µes cr√≠ticas para evitar p√°ginas em branco
            const opt = {
                margin:       [0, 0, 0, 0], // Margem zero para aproveitar o papel
                filename:     `CHECKLIST - ${placa}.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { 
                    scale: 2, 
                    scrollY: 0,      // ESSENCIAL: Ignora a rolagem atual da tela
                    useCORS: true    // Permite carregar a imagem da logo externa
                },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // 5. Adiciona classe para esconder bot√µes temporariamente
            document.body.classList.add('generating-pdf');
            document.querySelectorAll('.hide-on-pdf').forEach(el => el.style.display = 'none');
            document.querySelector('.pdf-watermark').style.display = 'block';

            // 6. Gera
            html2pdf().set(opt).from(element).save().then(() => {
                // Restaura UI
                document.querySelectorAll('.hide-on-pdf').forEach(el => el.style.display = '');
                document.querySelector('.pdf-watermark').style.display = 'none';
                btn.innerHTML = originalText;
                btn.disabled = false;
                showMsg('PDF Baixado com sucesso!');
            }).catch(err => {
                console.error(err);
                document.querySelectorAll('.hide-on-pdf').forEach(el => el.style.display = '');
                document.querySelector('.pdf-watermark').style.display = 'none';
                btn.innerHTML = originalText;
                btn.disabled = false;
                showMsg('Erro ao gerar PDF', 'error');
            });
        }

        // --- HIST√ìRICO ---
        function carregarHistorico() {
            const db = JSON.parse(localStorage.getItem('volpini_db') || '[]');
            const lista = document.getElementById('listaHistorico');
            
            if(db.length === 0) {
                lista.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">Nenhum checklist salvo.</div>';
                return;
            }

            lista.innerHTML = db.map(item => `
                <div class="history-item">
                    <div class="history-info">
                        <h4>${item.placa} <small style="font-weight:400">| ${item.modelo}</small></h4>
                        <span>üìÖ ${item.data}</span>
                        <span>üë§ ${item.cliente}</span>
                    </div>
                    <button class="btn btn-outline" style="min-width:auto; padding:5px 10px;" onclick="carregarItem(${item.id})">üëÅÔ∏è Ver</button>
                </div>
            `).join('');
        }

        function carregarItem(id) {
            const db = JSON.parse(localStorage.getItem('volpini_db') || '[]');
            const item = db.find(x => x.id === id);
            if(!item) return;

            document.getElementById('nome').value = item.cliente;
            document.getElementById('placa').value = item.placa;
            document.getElementById('modelo').value = item.modelo;
            document.getElementById('telefone').value = item.telefone;
            document.getElementById('endereco').value = item.endereco;
            document.getElementById('km').value = item.km;
            document.getElementById('combustivel').value = item.combustivel;
            document.getElementById('obs').value = item.obs;
            
            // Limpa e marca checkboxes
            document.querySelectorAll('input[name="item"]').forEach(cb => cb.checked = false);
            if(item.itens) {
                item.itens.forEach(val => {
                    const cb = document.querySelector(`input[value="${val}"]`);
                    if(cb) cb.checked = true;
                });
            }

            switchTab('novo');
            showMsg('Checklist carregado do hist√≥rico', 'success');
            window.scrollTo(0,0);
        }

        function limparTela() {
            if(confirm('Limpar o formul√°rio atual?')) {
                document.getElementById('checklistForm').reset();
                document.getElementById('data').valueAsDate = new Date();
            }
        }

        function limparHistorico() {
            if(confirm('Apagar todo o hist√≥rico de checklists?')) {
                localStorage.removeItem('volpini_db');
                carregarHistorico();
                showMsg('Hist√≥rico limpo.');
            }
        }
    </script>
</body>
</html>
