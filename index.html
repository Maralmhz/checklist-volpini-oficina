<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#001a33">
    <meta name="description" content="Checklist Volpini PRO">
    <title>Checklist Volpini v4.0</title>
    
    <!-- Script PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --gold: #d4af37;
            --dark: #001a33;
            --light: #f5f5f5;
            --text: #333;
            --success: #27ae60;
            --error: #e74c3c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body {
            background-color: var(--light);
            color: var(--text);
            padding: 20px;
        }

        /* --- CONTAINER PRINCIPAL (ESTILO ORIGINAL) --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            overflow: hidden;
            position: relative;
        }

        /* --- HEADER COM DEGRAD√ä E LOGO GRANDE --- */
        .header {
            background: linear-gradient(135deg, #001a33 0%, #002b55 100%);
            color: var(--gold);
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 25px;
            border-bottom: 4px solid var(--gold);
            position: relative;
        }

        .logo-container {
            width: 130px; /* Aumentado */
            height: 130px; /* Aumentado */
            background: white;
            border-radius: 12px;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .logo-container img { width: 100%; height: 100%; object-fit: contain; }

        .header-content h1 { 
            font-size: 28px; 
            font-weight: 800; 
            text-transform: uppercase; 
            margin-bottom: 5px; 
            letter-spacing: 1px;
            color: white;
        }
        
        .header-content p { color: var(--gold); font-weight: 500; margin-bottom: 10px; }
        
        .contact-info {
            font-size: 13px;
            color: rgba(255,255,255,0.8);
            margin-top: 5px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        /* --- BOLINHA PISCANDO (STATUS) --- */
        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .blink-dot {
            width: 8px;
            height: 8px;
            background-color: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--success);
            animation: pulse 1.5s infinite;
        }
        
        .blink-dot.offline { background-color: var(--error); box-shadow: 0 0 5px var(--error); animation: none; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* --- TABS --- */
        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 1px solid #ddd;
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: #555;
            flex: 1;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: white;
            color: var(--dark);
            border-bottom-color: var(--gold);
        }

        /* --- FORMUL√ÅRIO --- */
        .content-area { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeEffect 0.4s; }

        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        .section-title {
            background-color: var(--dark);
            color: var(--gold);
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: 700;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        .full { grid-template-columns: 1fr; }

        .form-group { display: flex; flex-direction: column; }
        
        label { 
            font-weight: 600; 
            margin-bottom: 6px; 
            color: var(--dark); 
            font-size: 13px;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            transition: 0.3s;
            background: #fff;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        /* --- CHECKBOXES ESTILIZADOS --- */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #eee;
        }

        .cb-item { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--gold); }

        /* --- BOT√ïES --- */
        .btn-container {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 14px;
            transition: 0.2s;
        }

        .btn-primary { background-color: var(--gold); color: var(--dark); }
        .btn-primary:hover { background-color: #c19d1f; transform: translateY(-2px); }
        
        .btn-pdf { background-color: var(--dark); color: white; border: 1px solid var(--gold); }
        .btn-pdf:hover { background-color: var(--gold); color: var(--dark); }

        .btn-clear { background-color: #eee; color: #555; }

        /* --- HIST√ìRICO --- */
        .history-card {
            background: white;
            border-left: 5px solid var(--gold);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- AJUSTES PARA O PDF --- */
        /* Essa classe √© ativada no body durante a gera√ß√£o do PDF */
        body.generating-pdf .hide-on-pdf { display: none !important; }
        
        body.generating-pdf .container {
            width: 100% !important;
            max-width: 100% !important;
            box-shadow: none !important;
            margin: 0 !important;
            border: none !important;
        }

        body.generating-pdf .header {
            padding: 15px !important;
            background: #001a33 !important; /* Remove degrad√™ para garantir cor s√≥lida */
            -webkit-print-color-adjust: exact;
        }

        body.generating-pdf input, 
        body.generating-pdf select, 
        body.generating-pdf textarea {
            border: 1px solid #000 !important; /* Borda preta forte */
            background: #fff !important;
            color: #000 !important; /* Texto preto absoluto */
            font-weight: 600 !important;
        }

        body.generating-pdf label { color: #000 !important; font-weight: bold !important; }
        
        /* Evita quebra de p√°gina dentro de se√ß√µes */
        .section-title, .row, .checkbox-group { page-break-inside: avoid; }

        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .row { grid-template-columns: 1fr; }
            .btn-container { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div class="container" id="app">
        <!-- HEADER -->
        <div class="header">
            <div class="logo-container">
                <img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/bbac6cb8-036e-4ce1-852d-e6c3397ecc20" alt="Logo">
            </div>
            <div class="header-content">
                <h1>Checklist de Oficina</h1>
                <p>Inspe√ß√£o T√©cnica Veicular - Volpini</p>
                <div class="contact-info">
                    <span>üìç R. D, 101 - Jardim Vera Cruz, Contagem - MG</span>
                    <span>üìû (31) 99331-0800 | üì± (31) 99331-0800</span>
                </div>
            </div>
            <div class="status-badge">
                <div class="blink-dot" id="connectionDot"></div>
                <span id="connectionText">ONLINE</span>
            </div>
        </div>

        <!-- ABAS -->
        <div class="tabs hide-on-pdf">
            <button class="tab-btn active" onclick="switchTab('tab-novo')">‚ûï NOVO CHECKLIST</button>
            <button class="tab-btn" onclick="switchTab('tab-historico')">üìã HIST√ìRICO</button>
        </div>

        <!-- CONTE√öDO: NOVO -->
        <div id="tab-novo" class="tab-content active content-area">
            <form id="checklistForm">
                
                <!-- DADOS CLIENTE -->
                <div class="section-title">üë§ DADOS DO CLIENTE</div>
                <div class="row">
                    <div class="form-group">
                        <label>Nome Completo *</label>
                        <input type="text" id="cliente_nome" placeholder="Ex: Jo√£o Silva" required>
                    </div>
                    <div class="form-group">
                        <label>Telefone / WhatsApp</label>
                        <input type="tel" id="cliente_tel" placeholder="(31) 99999-9999">
                    </div>
                </div>
                <div class="row full">
                    <div class="form-group">
                        <label>Endere√ßo Completo</label>
                        <input type="text" id="cliente_end" placeholder="Rua, N√∫mero, Bairro...">
                    </div>
                </div>

                <!-- DADOS VE√çCULO -->
                <div class="section-title">üöó DADOS DO VE√çCULO</div>
                <div class="row">
                    <div class="form-group">
                        <label>Placa do Ve√≠culo *</label>
                        <input type="text" id="veiculo_placa" placeholder="ABC-1234" maxlength="8" style="text-transform: uppercase; font-weight: bold; letter-spacing: 2px;" required>
                    </div>
                    <div class="form-group">
                        <label>Modelo / Marca</label>
                        <input type="text" id="veiculo_modelo" placeholder="Ex: Fiat Toro">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Quilometragem (KM)</label>
                        <input type="number" id="veiculo_km">
                    </div>
                    <div class="form-group">
                        <label>Combust√≠vel</label>
                        <select id="veiculo_combustivel">
                            <option value="">Selecione...</option>
                            <option value="Reserva">Reserva</option>
                            <option value="1/4">1/4 Tanque</option>
                            <option value="1/2">Meio Tanque</option>
                            <option value="3/4">3/4 Tanque</option>
                            <option value="Cheio">Cheio</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Data de Entrada</label>
                        <input type="date" id="data_entrada">
                    </div>
                </div>

                <!-- VISTORIA -->
                <div class="section-title">üîß ITENS DE VISTORIA (Check se possuir)</div>
                <div class="checkbox-group">
                    <div class="cb-item"><input type="checkbox" name="item" value="Estepe" id="c1"><label for="c1">Estepe</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Macaco" id="c2"><label for="c2">Macaco</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Chave de Roda" id="c3"><label for="c3">Chave Roda</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Tri√¢ngulo" id="c4"><label for="c4">Tri√¢ngulo</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Extintor" id="c5"><label for="c5">Extintor</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="R√°dio/Multim√≠dia" id="c6"><label for="c6">R√°dio/Som</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Ar Condicionado" id="c7"><label for="c7">Ar Cond.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Vidros El√©tricos" id="c8"><label for="c8">Vidros El√©t.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Travas El√©tricas" id="c9"><label for="c9">Travas El√©t.</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Alarme" id="c10"><label for="c10">Alarme</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Documento" id="c11"><label for="c11">Documento</label></div>
                    <div class="cb-item"><input type="checkbox" name="item" value="Antena" id="c12"><label for="c12">Antena</label></div>
                </div>

                <!-- OBSERVA√á√ïES -->
                <div class="section-title">üìù SERVI√áOS E OBSERVA√á√ïES</div>
                <div class="row full">
                    <textarea id="observacoes" rows="5" placeholder="Descreva os servi√ßos solicitados e avarias encontradas no ve√≠culo..."></textarea>
                </div>

            </form>

            <!-- BOT√ïES -->
            <div class="btn-container hide-on-pdf">
                <button class="btn btn-primary" onclick="salvarLocal()">üíæ SALVAR NO DISPOSITIVO</button>
                <button class="btn btn-pdf" id="btnGerarPDF" onclick="gerarPDF()">üìÑ BAIXAR PDF</button>
                <button class="btn btn-clear" onclick="limparForm()">üóëÔ∏è LIMPAR</button>
            </div>
        </div>

        <!-- CONTE√öDO: HIST√ìRICO -->
        <div id="tab-historico" class="tab-content content-area">
            <h3 style="margin-bottom:20px; color:var(--dark);">Checklists Salvos</h3>
            <div id="historico-lista">
                <p style="color:#777;">Nenhum item salvo ainda.</p>
            </div>
            <button class="btn btn-clear" style="margin-top:20px; width:100%;" onclick="limparHistoricoGeral()">Apagar Todo Hist√≥rico</button>
        </div>
    </div>

    <script>
        // --- DATA AUTOM√ÅTICA ---
        document.getElementById('data_entrada').valueAsDate = new Date();

        // --- MONITOR DE CONEX√ÉO ---
        function updateStatus() {
            const dot = document.getElementById('connectionDot');
            const text = document.getElementById('connectionText');
            if(navigator.onLine) {
                dot.classList.remove('offline');
                text.innerText = 'ONLINE';
            } else {
                dot.classList.add('offline');
                text.innerText = 'OFFLINE';
            }
        }
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        updateStatus();

        // --- NAVEGA√á√ÉO DE ABAS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            if(tabId === 'tab-historico') carregarHistorico();
        }

        // --- SALVAR NO LOCALSTORAGE ---
        function salvarLocal() {
            const placa = document.getElementById('veiculo_placa').value.toUpperCase();
            if(!placa) return alert('Por favor, informe a PLACA do ve√≠culo.');

            const dados = {
                id: Date.now(),
                cliente: document.getElementById('cliente_nome').value,
                placa: placa,
                modelo: document.getElementById('veiculo_modelo').value,
                tel: document.getElementById('cliente_tel').value,
                end: document.getElementById('cliente_end').value,
                km: document.getElementById('veiculo_km').value,
                comb: document.getElementById('veiculo_combustivel').value,
                data: document.getElementById('data_entrada').value,
                obs: document.getElementById('observacoes').value,
                itens: Array.from(document.querySelectorAll('input[name="item"]:checked')).map(i => i.value)
            };

            const db = JSON.parse(localStorage.getItem('volpini_v4') || '[]');
            db.unshift(dados);
            localStorage.setItem('volpini_v4', JSON.stringify(db));
            
            alert('‚úÖ Checklist Salvo com Sucesso!');
        }

        // --- CARREGAR HIST√ìRICO ---
        function carregarHistorico() {
            const db = JSON.parse(localStorage.getItem('volpini_v4') || '[]');
            const container = document.getElementById('historico-lista');
            
            if(db.length === 0) {
                container.innerHTML = '<p style="color:#777;">Nenhum item salvo ainda.</p>';
                return;
            }

            container.innerHTML = db.map(item => `
                <div class="history-card">
                    <div>
                        <strong style="color:var(--dark); font-size:16px;">${item.placa}</strong>
                        <div style="font-size:12px; color:#666;">${item.modelo} | ${item.cliente}</div>
                        <div style="font-size:11px; color:#999;">üìÖ ${item.data}</div>
                    </div>
                    <button onclick="restaurarChecklist(${item.id})" style="padding:5px 10px; background:var(--gold); border:none; border-radius:4px; font-weight:bold; cursor:pointer;">Ver</button>
                </div>
            `).join('');
        }

        function restaurarChecklist(id) {
            const db = JSON.parse(localStorage.getItem('volpini_v4') || '[]');
            const item = db.find(x => x.id === id);
            if(!item) return;

            document.getElementById('cliente_nome').value = item.cliente;
            document.getElementById('veiculo_placa').value = item.placa;
            document.getElementById('veiculo_modelo').value = item.modelo;
            document.getElementById('cliente_tel').value = item.tel;
            document.getElementById('cliente_end').value = item.end;
            document.getElementById('veiculo_km').value = item.km;
            document.getElementById('veiculo_combustivel').value = item.comb;
            document.getElementById('data_entrada').value = item.data;
            document.getElementById('observacoes').value = item.obs;

            document.querySelectorAll('input[name="item"]').forEach(cb => cb.checked = false);
            item.itens.forEach(val => {
                const el = document.querySelector(`input[value="${val}"]`);
                if(el) el.checked = true;
            });

            switchTab('tab-novo');
            // For√ßa o bot√£o da aba a ficar ativo visualmente
            document.querySelectorAll('.tab-btn')[0].click();
        }

        function limparForm() {
            if(confirm('Limpar o formul√°rio?')) document.getElementById('checklistForm').reset();
        }

        function limparHistoricoGeral() {
            if(confirm('Apagar TUDO?')) {
                localStorage.removeItem('volpini_v4');
                carregarHistorico();
            }
        }

        // --- GERA√á√ÉO DE PDF OTIMIZADA ---
        function gerarPDF() {
            const placa = document.getElementById('veiculo_placa').value || 'SEM-PLACA';
            const element = document.getElementById('app');
            const btn = document.getElementById('btnGerarPDF');

            // Feedback visual
            btn.innerHTML = '‚è≥ Criando PDF...';
            document.body.classList.add('generating-pdf'); // Ativa modo de alto contraste

            const opt = {
                margin:       [10, 0, 10, 0], // Margens superior/inferior para evitar cortes
                filename:     `CHECKLIST - ${placa.toUpperCase()}.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                btn.innerHTML = 'üìÑ BAIXAR PDF';
                document.body.classList.remove('generating-pdf');
            }).catch(err => {
                console.error(err);
                alert('Erro ao gerar PDF. Tente novamente.');
                btn.innerHTML = 'üìÑ BAIXAR PDF';
                document.body.classList.remove('generating-pdf');
            });
        }
    </script>

</body>
</html>
